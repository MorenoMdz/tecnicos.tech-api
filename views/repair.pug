extends layout

include mixins/_commentForm.pug

block content
  // pre= h.dump(repair)
  .container
    .row
      .mb-3.col-md-5
        .wrapper
          .card-body
            .card-header.card.text-white.bg-info.text-center
              h5.card-title Reparo para o defeito: #{repair.problem.title} 
            img.card-img-top.hwCardImg.py-3(src=`/uploads/${repair.photo || 'store.png'}` alt='Card image cap') 
          .card-body.card.text-white.bg-secondary.text-center
            if user
              .star.star_action
                form.star(method="POST" action=`/api/repairs/${repair._id}/star`)
                  - const starStrings = user.stars.map(obj => obj.toString())
                  - const starClass = starStrings.includes(repair._id.toString()) ? 'star-filled' : ''
                  button.btn.btn-secondary(type="submit" name="star" class=starClass) 
                    i.fa.fa-star
                    span #{` ${repair.stars.length} `}
                    if !starStrings.includes(repair._id.toString())
                      p.small.text-white Qualifique se o reparo deu resultado!
                
      ul.list-group.list-group-flush.col-md-7
        h6: li.list-group-item Título do reparo: 
          span.text-secondary #{repair.title}
        h6: li.list-group-item Aparelho: 
          span.text-secondary #{repair.hardware.name} 
        h6: li.list-group-item Modelo:  
          span.text-secondary #{repair.hardware.model}
        h6: li.list-group-item Componentes reparados:
          span.text-secondary #{repair.parts}
        h6: li.list-group-item Descrição do reparo:  
          span.text-secondary #{repair.description} Lorem ipsum dolor sit amet consectetur adipisicing elit. Ratione, asperiores dolorum. At iusto id, minus quia est provident omnis sequi sed, fugit excepturi, saepe natus? Rerum, atque eveniet. Id, sit?.
        li.list-group-item 
    
    p.text-white.bg-dark.p-2 Comentarios:
    section.comments.mt-3
      if repair.comments
        each comment in repair.comments
          article.comment
            a.comment-img(href='#non')
              img.avatar(src=comment.author.gravatar, alt="gravatar", width='80', height='80')
            .comment-body
              .text
                p #{comment.text}
              p.attribution
                | por
                |
                a(href='#non') #{comment.author.name}
                | 
                time(datetime=comment.created)= h.moment(comment.created).locale('pt-br').fromNow()
      if user
        +commentForm(repair)

